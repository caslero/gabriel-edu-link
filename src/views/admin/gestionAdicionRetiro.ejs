<div class="max-w-6xl mx-auto mt-10 bg-white rounded-lg shadow-lg p-8">
  <h2 class="text-2xl font-bold text-blue-700 mb-6">Gestión de Adición y Retiro</h2>

  <div class="bg-gray-50 p-6 rounded shadow mb-8">
    <h3 class="text-lg font-semibold text-blue-700 mb-4">Registrar nueva solicitud</h3>
    <form id="form-nueva-solicitud" class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <div class="md:col-span-2">
        <label for="buscarCedula" class="block font-semibold text-gray-700">Buscar estudiante por cédula</label>
        <div class="flex mb-2 rounded overflow-hidden border focus-within:ring-2 focus-within:ring-blue-500">
          <select id="prefijoCedula" class="border-none px-3 py-2 bg-gray-100 focus:outline-none">
            <option value="1">V-</option>
            <option value="0">E-</option>
          </select>
          <input type="text" id="buscarCedula" placeholder="Ej: 28051690" class="flex-1 px-3 py-2 focus:outline-none">
          <button type="button" id="btnBuscarCedula" class="bg-blue-600 text-white px-4 flex items-center justify-center hover:bg-blue-700 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 1110.5 3a7.5 7.5 0 016.15 13.65z" />
            </svg>
          </button>
        </div>
      </div>

      <div>
        <label for="estudiante_id" class="block font-semibold">Estudiante Seleccionado</label>
        <select id="estudiante_id" name="estudiante_id" class="w-full border p-2 rounded bg-gray-100" required disabled>
          <option value="">Realice una búsqueda por cédula...</option>
          </select>
      </div>


      <div>
        <label for="semestre_id" class="block font-semibold">Semestre</label>
        <select id="semestre_id" name="semestre_id" class="w-full border p-2 rounded" required disabled>
          <option value="">Selecciona el Semestre</option>
          <% semestres.forEach(sem => { %>
            <option value="<%= sem.semestre %>">Semestre <%= sem.semestre %></option>
          <% }) %>
        </select>
      </div>

      <div>
        <label for="materia_id" class="block font-semibold">Materia</label>
        <select id="materia_id" name="materia_id" class="w-full border p-2 rounded" required disabled>
          <option value="">Seleccione una materia</option>
          <% materias.forEach(mat => { %>
            <option value="<%= mat.id %>" data-semestre="<%= mat.semestre %>"><%= mat.nombre %></option>
          <% }) %>
        </select>
      </div>

      <div>
        <label for="seccion_id" class="block font-semibold">Sección</label>
        <select id="seccion_id" name="seccion_id" class="w-full border p-2 rounded" required disabled>
          <option value="">Seleccione una sección</option>
          <% secciones.forEach(sec => { %>
            <option value="<%= sec.id %>" data-materia="<%= sec.materia_id %>"><%= sec.nombre %></option>
          <% }) %>
        </select>
      </div>

      <div>
        <label for="tipo" class="block font-semibold">Tipo de solicitud</label>
        <select id="tipo" name="tipo" class="w-full border p-2 rounded" required disabled>
          <option value="Adicion">Adición</option>
          <option value="Retiro">Retiro</option>
        </select>
      </div>

      <div class="md:col-span-2">
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition w-full font-bold">
          Registrar solicitud aprobada
        </button>
      </div>
    </form>
  </div>
</div>

<div class="max-w-6xl mx-auto mt-10 space-y-10">
  
  <div class="bg-white rounded-lg shadow-lg p-8">
    <h3 class="text-lg font-semibold text-blue-700 mb-4">Solicitudes pendientes</h3>
    <div class="overflow-x-auto">
      <table id="tabla-pendientes" class="min-w-full border border-gray-200">
        <thead class="bg-yellow-500 text-white">
          <tr>
            <th class="px-4 py-2">ID</th>
            <th class="px-4 py-2">Estudiante</th>
            <th class="px-4 py-2">Materia</th>
            <th class="px-4 py-2">Tipo</th>
            <th class="px-4 py-2">Acciones</th>
          </tr>
        </thead>
        <tbody class="divide-y">
          <% if (pendientes && pendientes.length > 0) { %>
            <% pendientes.forEach(sol => { %>
              <tr data-id="<%= sol.id %>" class="hover:bg-gray-50 transition">
                <td class="px-4 py-2 text-center"><%= sol.id %></td>
                <td class="px-4 py-2 text-center"><%= sol.estudiante_nombre %></td>
                <td class="px-4 py-2 text-center text-sm"><%= sol.materia %></td>
                <td class="px-4 py-2 text-center font-bold text-xs"><%= sol.tipo %></td>
                <td class="px-4 py-2 text-center space-y-1">
                  <button onclick="gestionarSolicitud('<%= sol.id %>', 'Aprobada')" class="bg-green-600 text-white px-4 py-1 rounded text-sm hover:bg-green-700 w-24 shadow-sm">Aprobar</button>
                  <button onclick="gestionarSolicitud('<%= sol.id %>', 'Rechazada')" class="bg-red-600 text-white px-4 py-1 rounded text-sm hover:bg-red-700 w-24 shadow-sm">Rechazar</button>
                </td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="5" class="px-4 py-10 text-center text-gray-500 italic bg-gray-50">
                <div class="flex flex-col items-center justify-center">
                  No hay ninguna solicitud pendiente por procesar
                </div>
              </td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow-lg p-8">
    <h3 class="text-lg font-semibold text-blue-700 mb-4">Solicitudes procesadas</h3>
    <div class="overflow-x-auto">
     <table class="min-w-full border border-gray-200">
        <thead class="bg-blue-600 text-white">
            <tr>
                <th class="px-4 py-2">ID</th>
                <th class="px-4 py-2">Estudiante</th>
                <th class="px-4 py-2">Tipo</th> <th class="px-4 py-2">Estado</th>
            </tr>
        </thead>
        <tbody id="cuerpo-tabla-procesadas"> <% if (typeof procesadas !== 'undefined' && procesadas.length > 0) { %>
                <% procesadas.forEach(reg => { %>
                    <tr class="text-sm border-b">
                        <td class="px-4 py-2 text-center"><%= reg.id %></td>
                        <td class="px-4 py-2 text-center"><%= reg.estudiante_nombre %></td>
                        <td class="px-4 py-2 text-center"><%= reg.tipo %></td>
                        <td class="px-4 py-2 text-center">
                            <span class="<%= reg.estado === 'Aprobada' ? 'text-green-600' : 'text-red-600' %>">
                                <%= reg.estado %>
                            </span>
                        </td>
                    </tr>
                <% }) %>
            <% } else { %>
                <tr>
                    <td colspan="4" class="text-center py-4">No hay registros procesados.</td>
                </tr>
            <% } %>
        </tbody>
    </table>
    </div>
  </div>
</div>
<div id="modal-eliminar" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden flex items-center justify-center z-[60]">
    <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full mx-4">
        <div class="text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">¿Eliminar registro?</h3>
            <p class="text-sm text-gray-500 mb-6">Esta acción no se puede deshacer. El registro desaparecerá del historial procesado.</p>
        </div>
        <div class="flex space-x-3">
            <button onclick="cerrarModalEliminar()" class="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition font-semibold">
                Cancelar
            </button>
            <button onclick="ejecutarEliminacion()" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-semibold">
                Eliminar
            </button>
        </div>
    </div>
</div>
<div id="contenedor-notificaciones" class="fixed top-5 right-5 z-50 flex flex-col gap-2"></div>
<script src="/js/adicionRetiro.js"></script>